<%-
  item = @hostgroup || @host
-%>

<%= javascript 'foreman_passwordstate/host_extensions.js' %>

<%= fields_for item do |f| %>
<%= f.fields_for 'passwordstate_facet_attributes' do |f| %>
  <%-
    servers = PasswordstateServer.all.map do |server|
      [ server.id, "#{server.name} - #{server.url}" ]
    end
    server = item.try(:passwordstate_server) rescue nil
  -%>
  <%= select_f f, :passwordstate_server_id, servers, :first, :last,
    { include_blank: true, selected: server&.id },
    { disabled: servers.empty?,
      help_inline: :indicator,
      label: _('Passwordstate Server'),
      label_help: _("<b>NB</b>: Selecting a Passwordstate server will replace ALL password handling<br/>Resetting this option will clear ALL passwords"),
      label_help_options: { data: { placement: 'top' } },
      onchange: 'update_passwordstate_server(this);',
      'data-url': passwordstate_server_selected_hosts_path,
      'data-type': controller_name.singularize
    }
  %>
<% end -%>
<% end -%>
